connect eclipse and tomcat

1. eclipse ee 32bit
2. tomacat: service installer with user: admin
3. eclipse server add tomcat (c:\apache foundation...)

eclipse file new dynamicWebProject

run .jsp right click on the file, choose Run as, run on server. 
//for expression
convert string to upper case <%= new String("Hello World!").toUpperCase()%>
Captain log : now the time is <br />
<%= new java.util.Date() %>
//for scriptlet
<%
for (int i = 0; i < 5;  i++){
	out.println("i love jsp "+i);
}
%>

//for method declaration
<%! String makeItLower(String data){
	return data.toLowerCase();
}
%>
<br/><br/> //method call
HELLO to lower case <%=makeItLower("HELLO") %>

<%@ page import ="com.lovetocode.jsp.FunUtils, java.util.ArrayList"  %>

jsp built in server objects

<jsp:include page="my-header.html"></jsp:include>
<jsp:include page="my-footer.jsp"></jsp:include>

<form action="student-register.jsp">
First name : <input type = "text" name = "firstname"><br/><br/>
Last name : <input type = "text" name = "lastname"><br/><br/>
<input type = "submit" value = "Submit">
</form>

Student registration is confirmed: <br/> <br/>
<%= request.getParameter("firstname") %>  <%= request.getParameter("lastname") %>

${param.firstname} ${param.lastname }

Nationality: //drop down
<select name = "nationality" >
<option>France</option>
<option>German</option>
<option>Rather not say</option> 
</select>
<%= request.getParameter("nationality") %>

//check button
Languages you are willing to choose: <br/>
		<input type = "checkbox" name = "language" value = "C#">C#
		<input type = "checkbox" name = "language" value = "JAVA">JAVA
		<input type = "checkbox" name = "language" value = "C++">C++
		<input type = "checkbox" name = "language" value = "Python">Python<br/>

	<!-- display list create html dynamic -->
	<ul>		
		<%
		    String [] languages = request.getParameterValues("language");
		    if (languages != null){
		    	for (String language: languages){
		    	out.println("<li>"+language+"</li>");
		    }	
		    }

	    %>
	</ul>

	tracking unique user sessio id
	1. sesion id is unique, provided by tomcat server
	2. server memory not local pc ,not database
	3. session.setAtrribute(String attributename, value) //could be array 
	4. Object session.getAttribute(attributename)

	setMaxInactiveIneterval(milisec) //normaly is  30mins
	<body>
	<br />
	<br />
	<br />
	<!-- create FORM -->
	<form action="mylist.jsp">
		Add new Item: <input type="text" name="items"> <input
			type="submit" value="Submit">
	</form>
	<!-- submit items  -->
	<%  //get session attribute the list
    	List<String> itemsEntered = (List<String>)session.getAttribute("itemsEnteredByFar");
    	//if does not exist, create it
    	if (itemsEntered == null){
    		itemsEntered = new ArrayList<String>();
    		session.setAttribute("itemsEnteredByFar", itemsEntered);
    	}
    	//add data to the list
    	String itemToAdd = request.getParameter("items");
    	if( itemToAdd!= null){
    		itemsEntered.add(itemToAdd);
    	}
    %>
	<br />
	<br />
	<br />
	<hr>
	<br />
	<br />
	<br /> Item entered:
	<!-- display items -->
	<ol>
		<%
            for (String tempItem:itemsEntered ){
            	out.println("<li>"+tempItem+"</li>");
            }
        %>
	</ol>

</body>

By default, JSPs have session tracking enabled and a new HttpSession object is instantiated for each new client automatically. Disabling session tracking requires explicitly turning it off by setting the page directive session attribute to false as follows:
<em><%@ page session="false" %>
</em>


Cookies
1. session is short, like 30 mins
2. Cookies help to personalize the website for a user, by keep tracking the users preference long term cookie.setMaxAge(60*60*24*365);
3. cookies are basicly text data (name, value) pairs exchanged between web browser and server
4. web browser only send the cookie to server of which the domain match
5. javax.servlet.http.Cookie cookie.getName(); cookie.getValue(); new Cookie(string name, String value);

Homepage.jsp:
                  show content based on a default language
                  get cookie to update the lang Cookie [] cookies = request.getCookies();
                  if client click on change lang setting, go to that page 
Change lang page.html:
                  show the form for client to fill

Change lang page.jsp: 
                  create cookie based on the what lang the cient has chosen response.addCookie(cookie);
                  confirm the setting change
                  if the client click on the return to home page

    // encode cookie data ... handle case of languages with spaces in them
    favLang = URLEncoder.encode(favLang, "UTF-8");             
    // decode cookie data ... handle case of languages with spaces in them
    favLang = URLDecoder.decode(tempCookie.getValue(), "UTF-8");
JSP Custome Tag benefit
1. minimize the amount of scriptlet code in jsp
2. avoid dumping too much java code in jsp
3. separte presentation and business logic
4. Tag is reusable

JSP Standard tag library: JSTL
//loop the cookies on this domain
<c:forEach items="${cookie}" var="currentCookie">  
    Cookie name as map entry key: ${currentCookie.key} <br/>
    Cookie object as map entry value: ${currentCookie.value} <br/>
    Name property of Cookie object: ${currentCookie.value.name} <br/>
    Value property of Cookie object: ${currentCookie.value.value} <br/>
</c:forEach>

<%
List<Student> students = new ArrayList<Student> ();
students.add(new Student("Wen","Zhao",true));
students.add(new Student("Xue","Gong",false));
students.add(new Student("Ping","Cao",true));
pageContext.setAttribute("studentsList",students);
    
%>
//dislay a table deprived from a ArrayList of object
<table>
<col width = "120">
<col width = "120">
<col width = "120">
<tr>
<th>First Name</th>
<th>Last Name</th>
<th>VIP</th>
</tr>
//studentsList request attribute defined by setAttribute
<c:forEach var = "temp" items = "${studentsList}">
<tr>
<td>${temp.firstName}</td>
<td>${temp.getLastName()}</td>
<td>${temp.isGoldStudent()}</td>
</tr>
</c:forEach>
</table>


<c:if test = "${temp.isGoldStudent()}">
Special discount available!
</c:if>

<c:if test = "${not temp.isGoldStudent()}">
Get VIP to benefit further
</c:if>

<c:choose>
<c:when test = "${temp.isGoldStudent()}"> Special discount available!</c:when>
<c:otherwise> Get VIP to benefit further </c:otherwise>
</c:choose>


<%@ taglib prefix = "fn" uri = "http://java.sun.com/jsp/jstl/functions" %>
 <%@ taglib uri = "http://java.sun.com/jsp/jstl/core" prefix = "c"%>
 <c:set var = "actor" value = "Chandler"></c:set>
Length of ${actor}:${fn:length(actor)}<br/>
Upper case him: ${fn:toUpperCase(actor)}
Does his name start with Ch ?: ${fn:startsWith(actor,"Ch") }

<c:set var = "cities" value = "Paris,Shenzhen,Athens,Shanghai"/>
<c:set var = "citiesArray" value = "${fn:split(cities,',')}"/>
<c:forEach var = "city" items = "${citiesArray }" >
${city}<br/>
</c:forEach>
<c:set var = "citiesJoined" value = "${fn:join(citiesArray,'-')}"/>
${citiesJoined }

JSP - Internationalization| i18n
localization| l10n

Locale = language + region
en_US
en_UK
mylabels.properties
label.greeting = Howdy
label.firstName = First Name
lable.lastName = Last Name
lable.message = Welcome to this class!
mylabels_en_US.properties
<%@ taglib uri = "http://java.sun.com/jsp/jstl/fmt" prefix = "fmt" %>

      <fmt:setLocale value = "en"/>
      <fmt:setBundle basename = "com.tutorialspoint.Example" var = "lang"/>

      <fmt:message key = "count.one" bundle = "${lang}"/><br/>
      <fmt:message key = "count.two" bundle = "${lang}"/><br/>
      <fmt:message key = "count.three" bundle = "${lang}"/><br/>
 //set variable the local
<c:set var = "theLocal"
value = "${not empty param.theLocal ? param.theLocal : pageContext.request.locale}"
scope = "session"/>
//set locale 
<fmt:setLocale value = "${theLocal}"/>
//set bundle
<fmt:setBundle basename = "com.example.wen.i18n.resources.mylabels"/>
<a href="i18n-test.jsp?theLocal=en_US">English (US)</a>  &nbsp; | &nbsp;
<a href="i18n-test.jsp?theLocal=fr_FR">French (FR)</a> &nbsp; | &nbsp;
<a href="i18n-test.jsp?theLocal=zh_CN">Chinese (CN)</a><br/>
<hr>
//refer to message acorrding to the defined labels
<fmt:message key = "label.greeting"/><br/>
<fmt:message key = "label.firstName"/>: John<br/>
<fmt:message key = "label.lastName"/>: Doe<br/>
<fmt:message key = "label.welcome"/>
<hr>
The selected Locale:${theLocal} 

Servlets:
java class that is processed on the server
java class genertate HTML that is returned to browser
can read HTIML form data use cookies and sessions

Model View Controller MVC design pattern
Servlet handle busines logic
jsp presentation view

HTTP 404 not found(Servlet not found) [duplicate]

1. I had suffered this problem too. Whenever we delete a tomcat server and run our project in new one without build classpaths and clean and build that project, we got this type of exceptions.
So, Build your projects classpath. Goto property of your Project then Select =>Java Build Path => Order and Export. Select All classpaths.

2. Cleaning all projects works too

get  vs post
get:arameters remain in browser history because they are part of the URL	
post: Parameters are not saved in browser history.

get: can send but the parameter data is limited to what we can stuff into the request line (URL). Safest to use less than 2K of parameters, some servers handle up to 64K
post:Can send parameters, including uploading files, to the server.

<init-param> vs <context-param> 

<init-param> and <context-param> are the static parameters which are stored in web.xml file. If you have any data which doesn't change frequently you can store it in one of them.

If you want to store particular data which is only confined to a particular servlet scope, then you can use <init-param> .Anything you declare inside <init-param> is only accessible only for that particular servlet.The init-param is declared inside the <servlet> tag.

<servlet>
     <display-name>HelloWorldServlet</display-name>
     <servlet-name>HelloWorldServlet</servlet-name>
     <init-param>
         <param-name>Greetings</param-name>
         <param-value>Hello</param-value>
     </init-param>
</servlet>
and you can access those parameters in the servlet as follows:

out.println(getInitParameter("Greetings"));
If you want to store data which is common for whole application and if it doesn't change frequently you can use <context-param> instead of servletContext.setAttribute() method of the application context. For more information regarding usage of <context-param> VS ServletContext.setAttribute() have a look at this question. context-param are declared under the tag web-app. You can declare and access the <context-param> as follows

<web-app>
    <context-param>
        <param-name>Country</param-name>
        <param-value>India</param-value>
    </context-param>
    <context-param>
        <param-name>Age</param-name>
        <param-value>24</param-value>
    </context-param>
</web-app>
Usage in the application either in a JSP or Servlet

getServletContext().getInitParameter("Country");
getServletContext().getInitParameter("Age");

if want to use servlet level context param, IMPORTANT: Your servlet can not use Annotations for @WebServlet. It has to be manually configured in web.xml with <servlet> and <servlet-mapping> tags

		response.setContentType("text/html");
		PrintWriter out = response.getWriter();
		ServletContext context = getServletContext();
		String maxSize = context.getInitParameter("shopping-cart-max-items");
		String teamName = context.getInitParameter("team-name");
		out.println("<html><body>");
		out.println("<br/><br/>");
		out.println("Max items in shopping cart: " + maxSize);
		out.println("<br/><br/>");
		out.println("Powered by :"+teamName);
		out.println("</body></html>");

WEB-INF lib add jstl jars.

MVC DEMO
	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		// TODO Auto-generated method stub
		//add data
		String [] students = {"Mary","John","Wendy","Miles"};
		request.setAttribute("student_list", students);
		//get request dispatcher
		RequestDispatcher RequetsDispatcherObj =request.getRequestDispatcher("/student-info-jsp.jsp");
		//forward request to jsp
		RequetsDispatcherObj.forward(request, response); 
	}

JSP:<c:forEach var = "temp" items = "${student_list}">
Student: <c:out value=" ${temp}"/>
</c:forEach>

community server installer mysql
win 32bit
password: admin

tomcat user: admin
password: admin 

Tomcat database connection pool
1. mysql 
2. jdbc driver for given database->WEB-INF->lib
3. define connection pool: context.html META-INF/context.html
4. get connection by resource annotation in javacode

DataSource connecting pool

Data access object DAO

Web browser ->Servlet(controller) - >Data access helper class(model) -> database
Servlet(controller) -> jsp(View)->web browser

servlet calls db model via datasource

public  ArrayList<Student> getStudentList(){
		ArrayList<Student> students = new ArrayList<Student> ();
		
		Connection conn = null;
        Statement statement = null;
        ResultSet resultSet = null;
        String query = "SELECT * FROM web_student_tracker.student";
        
        try{
        	conn = dataSource.getConnection();
        	statement = conn.createStatement();
        	resultSet = statement.executeQuery(query);
        
        	while(resultSet.next()){
        		students.add(new Student(resultSet.getString("first_name"),resultSet.getString("last_name"),resultSet.getString("email")));
        	}
        	conn.close();
        	statement.close();
        	resultSet.close();
        	
        }catch(Exception e){
        	e.printStackTrace();
        }
		return students;
	}

	MVC servlet class we override the init(); we put code which we normally put inside a constructor
	<body>
	<div id="wrapper">
		<div id="header">
			<h2>King George University</h2>
		</div>
	</div>

	<div id="container">
		<div id=content>
			<table>
				<tr>
					<th>First Name</th>
					<th>Last Name</th>
					<th>Email</th>
					<%
						for (Student temp : students) {
					%>
				
				<tr>
					<td><%=temp.getFirstName() %></td>
					<td><%=temp.getLastName() %></td>
					<td><%=temp.getEmail() %></td>

				</tr>
				<%} %>


			</table>

		</div>
	</div>
</body>


replace jsp scriptlets with jstl

// get version info using an jsp file
Server Version: <%= application.getServerInfo() %><br>
Servlet Version: <%= application.getMajorVersion() %>.<%= application.getMinorVersion() %>
JSP Version: <%= JspFactory.getDefaultFactory().getEngineInfo().getSpecificationVersion() %> <br>



 <input class="add-student-button" type="submit" value="Add Student"
 onclick = "window.location.href='add-student-form.jsp';return false;"/>


<link type = "text/css" rel = "stylesheet" href = "css/style.css"/>


		<form action="StudentControllerServlet" method="GET">
			<input type="hidden" name="command" value="ADD" />
			<table>
				<tbody>
					<tr>
						<td><label>First Name</label></td>
						<td><input type="text" name="firstName"></td>
					</tr>
					<tr>
						<td><label>Last Name</label></td>
						<td><input type="text" name="lastName"></td>
					</tr>
					<tr>
						<td><label>Email</label></td>
						<td><input type="text" name="email"></td>
					</tr>
					<tr>
						<td><label></label></td>
						<td><input type="submit" value="Submit" class = "save"></td>
					</tr>
				</tbody>
			</table>
		</form>

	public void addStudent(Student newStudent) {
		// TODO Auto-generated method stub
		//get connection and statement
		Connection conn = null;
		PreparedStatement preparedstat = null;
		//get table column information based  on the student object
		String firstName = newStudent.getFirstName();
		String lastName = newStudent.getLastName();
		String email = newStudent.getEmail();
		//create sql
		//INSERT INTO TABLE_NAME (column1, column2, column3,...columnN)  
		//VALUES (value1, value2, value3,...valueN);
		String query = "INSERT INTO web_student_tracker.student (first_name,last_name,email) VALUES(?,?,?)";
		//INSERT into customer_info.customer (first_name,last_name,email) VALUES ("wen","lee","wen@gmail.com");
		
		try{
			conn = dataSource.getConnection();
			preparedstat = conn.prepareStatement(query);			
			
			preparedstat.setString(1,firstName);
			preparedstat.setString(2, lastName);
			preparedstat.setString(3, email);			
			//execute sql
			preparedstat.execute();

					<c:forEach var="temp" items="${student_info_list}">
					<tr>
						<!-- for each student, define the url-->
						<c:url var="templink" value="StudentControllerServlet">
							<c:param name="command" value="LOAD" />
							<c:param name="studentId" value="${temp.id}" />
						</c:url>


boolean execute()
Executes the SQL statement in this PreparedStatement object, which may be any kind of SQL statement.

ResultSet executeQuery()
Executes the SQL query in this PreparedStatement object and returns the ResultSet object generated by the query.

int executeUpdate()
Executes the SQL statement in this PreparedStatement object, which must be an SQL INSERT, UPDATE or DELETE statement; or an SQL statement that returns nothing, such as a DDL statement.

Actually, valueOf uses parseInt internally. The difference is parseInt returns an int primitive while valueOf returns an Integer object.


getParameter() returns http request parameters. Those passed from the client to the server. For example http://example.com/servlet?parameter=1. Can only return String
getAttribute() is for server-side usage only - you fill the request with attributes that you can use within the same request. For example - you set an attribute in a servlet, and read it from a JSP. Can be used for any object, not just string.


		Connection conn = null;
		PreparedStatement stat = null;
		String query = "UPDATE web_student_tracker.student SET first_name = ?, last_name = ?, email = ? WHERE id = ?";	    
		try{
			conn = dataSource.getConnection();
			stat = conn.prepareStatement(query);
			stat.setString(1, studentToUpdate.getFirstName());
			stat.setString(2, studentToUpdate.getLastName());
			stat.setString(3, studentToUpdate.getEmail());
			stat.setInt(4, studentToUpdate.getId());	
			
			stat.executeUpdate();

deploy war file:
1. In Eclipse, stop Tomcat

2. Right-click your project and select Export > WAR File

3. In the Destination field, enter: <any-directory>/mycoolapp.war

4. Outside of Eclipse, start Tomcat
- If you are using MS Windows, then you should find it on the Start menu

5. Make sure Tomcat is up and running by visiting: http://localhost:8080

6. Deploy your new WAR file by copying it to <tomcat-install-directory>\webapps

Give it about 10-15 seconds to make the deployment. You'll know the deployment is over because you'll see a new folder created in webapps ... with your WAR file name.

7. Visit your new app. If your war file was: mycoolapp.war then you can access it with:  http://localhost:8080/mycoolapp/


You would use the exact same technique of using bootstrap with any regular HTML file.

1. Load the bootstrap files in the <head> section of your JSP file

2. Apply the bootstrap styles in the JSP file on html tags.

Inversion of control:
the approche of outsourcing the construction and managemeng of objects

Spring container primary functions
1.create and manage objects(inversion of control)
2. inject object's dependencies(Dependency injection)

configuring spring container
1. xml
2. java annotation
3. java source code

spring xml vs annotation

Spring developement process
1. config spring bean(applicationContext.xml)
2. create a spring container (ApplicationContext)
3. retrieve spring bean from spring container

 	<bean id="myCoach"
 		class="com.example.wen.springdemo.YogaCoach">	 		
 	</bean>

		//load spring configuration file
		ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext("applicationContext.xml");
		//retrieve bean from container
		Coach theCoach = context.getBean("myCoach",Coach.class);		
		//call method on the bean
		System.out.println(theCoach.getDailyWorkout());		
		//close the context
		context.close();
Dependency injection:
1. dependency something as "helper objects"
2. two most common ones are "constructor injection" and "setter injection"

Constructor injection:
1. define dependency interface and class
2. create constructor for injections
3. config the dependency in spring file <constructor-arg ref = "myFortuneService"/>	

Setter injection:
1.create setter methods in the class for injection
2. config the dependency in spring config file

code to interface not to implementation
		// load spring config file
		ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext("applicationContext.xml");
		//retrieve bean from spring container
		CricketCoach coach = context.getBean("myCricketCoach",CricketCoach.class);
		//call methods on bean
		System.out.println(coach.getDailyWorkout());
		System.out.println(coach.getFortune());
		//close the context
		context.close();
<bean id="myCoach"
 		class="com.example.wen.springdemo.TrackCoach">	 
 		<!-- set up constructor injection  -->
 		<constructor-arg ref = "myFortuneService"/>		
 	</bean>
         <!-- setter injection -->
        <property name = "mFortuneService" ref = "myFortuneService"/>  
        <!-- inject literal value-->  
        <property name = "email" value = "team@gmail.com"/>
        <property name = "team" value = "Go Google!"/>
sport.email = sportemail@outlook.com
sport.team = Android Orea

    <!-- load property file -->
 <context:property-placeholder location = "classpath:sport.properties"/>
 <property name = "email" value = "${sport.email}"/>
 <property name = "team" value = "${sport.team}"/>

 public class RandomFortuneService implements FortuneService {
	private String [] fortunes = {
			"Tomorrow is your lucky day!",
			"Today is the day!",
			"Tomrrow will be the best!"
	};

	@Override
	public String getFortune() {
		// TODO Auto-generated method stub
		Random random = new Random();
		int index = random.nextInt(fortunes.length);
		return fortunes[index];
	}

}

by default, bean scope is singleton, which means that spring only create one bean for each type and all the applications out there will share the same bean. good for stateless class, for saving the resources

prototype: a new object is created for each request, good for state classes

Bean lifecycle 
init -> destroy
define init and destroy method for the bean (has to be public void): 
		The methods should be public void
		The methods should be no-arg, meaning they shouldn't accept any method arguments.
config these methods in config file

 	<bean id="myCoach"
 		class="com.example.wen.springdemo.TrackCoach"
 		init-method = "initTrackCoach"
 		destroy-method = "destroyTrackCoach">
 		//define init method

	public void initTrackCoach(){
		System.out.println("Track coach init method");
	}
	public void destroyTrackCoach(){
		System.out.println("destroy track coach method");
	} 

Java annotation
1. special labels/markers added to java classes
2. provide meta-data about the classes
3. processed at run time or compile time

example: @Override

xml: too verbose when big project has thousands of beans
annotation: minimize the XML configuration

instead of load all the beans from XML file
spring will scan java classes for special annotation and automatically register the beans in the spring container

The @Component annotation marks a java class as a bean so the component-scanning mechanism of spring can pick it up and pull it into the application context. To use this annotation, apply it over class as below:

@Component
public class EmployeeDAOImpl implements EmployeeDAO {
    ...
}
set up spring fo java project
1. copy spring file to lib file under the project folder
2. build path->add JARs->select all the jars


<!-- add entry to enable component scanning -->
<context:component-scan base-package="com.example.wen.springdemoannotations"/>

//explicit name the bean ids
@Component("sillyTennisCoach")
public class TennisCoach implements Coach {

		//load spring config 
		ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext("applicationContext.xml");
		//retrieve beans
		Coach tennisCoach = context.getBean("sillyTennisCoach", Coach.class);
default bean id, class name with the first letter lower case. 


Autowiring injection type (xml, java annotations)
constructor injection
setter injection
field injection

constructor injection
1. define dependency interface and class (need @Component to register this class too for spring to look up the implementation of the interface)
2. create a constructor for injections
3. config the dependency injection with @AutoWiring annotation (@Autowired added above the constructor)

	@Autowired
	public TennisCoach(FortuneService fortuneService){
		this.fortuneService = fortuneService;
	}

setter injections with annotation and autowiring

1. create setter method in the class for injection
2. config the dependency injection with @AutoWiring annotation (@Autowired added above the setter)

method injections (setter injection is one special type of method injection)
1. define method requiring dependency injectin
2. @Autowired


Field injection
1. applied directly to the class fields even the private ones
2. no need setter methods

@Component
public class JoggingCoach implements Coach {
	@Autowired
	private FortuneService fortuneService;

code to interface not to implementation
choose a style and stay consistent //construction, method and field injections get the same result

Dependency Injection – Field vs Constructor vs Method

when there exisit multiple implementation of a certain interface, error : nouniquebeandefinitionexception
@Autowired
@Qualifier("happyFortuneService") //bean id not class name
private FortuneService fortuneService;
Qualifier can be used to all kinds of injections

beans vs classes
JavaBeans are classes that encapsulate many objects into a single object (the bean). They are serializable, have a zero-argument constructor, and allow access to properties using getter and setter methods.

A class is nothing but a blueprint or a template for creating different objects which defines its properties and behaviors. Java class objects exhibit the properties and behaviors defined by its class. A class can contain fields and methods to describe the behavior of an object.

when using qualifier, have to add qualier annotation for all Coach classes which meet the name injection needs
 inject properties file using Java annotations



Answer:

This solution will show you how inject values from a properties file using annotatons. The values will no longer be hard coded in the Java code.

1. Create a properties file to hold your properties. It will be a name value pair.  

New text file:  src/sport.properties

foo.email=myeasycoach@luv2code.com
foo.team=Silly Java Coders
Note the location of the properties file is very important. It must be stored in src/sport.properties

2. Load the properties file in the XML config file.

File: applicationContext.xml

Add the following lines:

    <context:property-placeholder location="classpath:sport.properties"/>  

This should appear just after the <context:component-scan .../> line

3. Inject the properties values into your Swim Coach: SwimCoach.java

   

@Value("${foo.email}")
private String email;
    
@Value("${foo.team}")
private String team;
---

DOWNLOAD FULL SOURCE CODE

You can download entire code from here:

- http://www.luv2code.com/downloads/spring-hibernate/spring-props-annotation-demo.zip

@Component
@Scope("prototype")
public class TennisCoach implements Coach {

init-method 
@PostConstruct

destroy-method
@PreDestroy


	
	//define my init method
	@PostConstruct
	public void doMyStuffForInit(){
		System.out.println("doMyStuffForInit");
	}
	//define my destroy method
	@PreDestroy
	public void doMyCleanUpStuff(){
		System.out.println("doMyCleanUpStuff");
	}
For "prototype" scoped beans, Spring does not call the @PreDestroy method.  Gasp!  
In contrast to the other scopes, Spring does not manage the complete lifecycle of a
prototype bean: the container instantiates, configures, and otherwise assembles a
prototype object, and hands it to the client, with no further record of that prototype
instance. 

Thus, although initialization lifecycle callback methods are called on all objects regardless of scope, in the case of prototypes, configured destruction lifecycle callbacks are not called. The client code must clean up prototype-scoped objects and release expensive resources that the prototype bean(s) are holding. 


	public FileFortuneService() {

		File theFile = new File(fileName);
		
		System.out.println("Reading fortunes from file: " + theFile);
		System.out.println("File exists: " + theFile.exists());
		
		// initialize array list
		theFortunes = new ArrayList<String>();
		
		// read fortunes from file
		try (BufferedReader br = new BufferedReader(
				new FileReader(theFile))) {

			String tempLine;

			while ((tempLine = br.readLine()) != null) {
				theFortunes.add(tempLine);
			}
			
		} catch (IOException e) {
			e.printStackTrace();
		}
	}

instead of spring configuration using XML, we could also configure the spring container using pure java code, no XML;
1. create java class and annotate as @Configuration
2. add @ComponentScan(packagename) //optional
3. read spring java configuration class  annotationconfigapplicationcontext(SportConfig.class)
4. retrieve beans

3 ways of configuration
1. full XML file
2. java annotion and <context:component-scan base-package = > to make xml smaller
3. pure java code (JAVA Spring configuration class)

	public static void main(String[] args) {
		//load spring config 
		AnnotationConfigApplicationContext context = new 

		(SportsConfig.class);
		//retrieve beans
		Coach coach = context.getBean("yogaCoach", Coach.class);
		//call methdods on the bean
		System.out.println(coach.getDailyWorkout());
		//close the container
		context.close();

	}
@Configuration
//@ComponentScan("com.example.wen.springdemoannotations")
@PropertySource("classpath:sport.properties")
public class SportsConfig {
	//define bean for fortune service
	@Bean
	public FortuneService tiredFortuneService (){//this method name will be bean id inside the spring container
		return new TiredFortuneService();
	}
	//define bean for swim coach and inject dependency
	@Bean
	public SwimCoach swimCoach(){
		return new SwimCoach(tiredFortuneService ());
	}

}	@Value("${email}")
	private String email;
	@Value("${team}")
	private String team;



Spring MVC
1. framework for building web application in java
2. based on the model-view-controller design pattern
3. leverage features of the core spring framework

Front controller is part of Spring framework and has been already built by spring team: dispatcher servlets
view : jsp +jstl page to render the data to display data to the user; various view templete
controller: place business logic and handler the request delegated from front controller 
model: a container for the data, for shipping data between different parts of spring mvc application
Spring MVC config

web.xml
<!-- Step 1: Configure Spring MVC Dispatcher Servlet -->
	<servlet>
		<servlet-name>dispatcher</servlet-name>
		<servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class>
		<init-param>
			<param-name>contextConfigLocation</param-name>
			<param-value>/WEB-INF/spring-mvc-demo-servlet.xml</param-value>
		</init-param>
		<load-on-startup>1</load-on-startup>
	</servlet>

	<!-- Step 2: Set up URL mapping for Spring MVC Dispatcher Servlet -->
	<servlet-mapping>
		<servlet-name>dispatcher</servlet-name>
		<url-pattern>/</url-pattern>
	</servlet-mapping>
	<!-- Step 3: Add support for component scanning -->
	<context:component-scan base-package="com.luv2code.springdemo" />

	<!-- Step 4: Add support for conversion, formatting and validation support -->
	<mvc:annotation-driven/>

	<!-- Step 5: Define Spring MVC view resolver -->
	<bean
		class="org.springframework.web.servlet.view.InternalResourceViewResolver">
		<property name="prefix" value="/WEB-INF/view/" />
		<property name="suffix" value=".jsp" />
	</bean>

	controller class
	define a class and add the annotation @Controller
	@Controller inherit from @Component and hence support scanning

Spring MVC setup in eclipse
1. create Dynamic Web Project in eclipse
2. copy \spring-framework-4.3.8.RELEASE-dist\spring-framework-4.3.8.RELEASE\libs all jars to WebContent/WEB-INF/lib
3. create controller 
4. WebContent/WEB-INF web.xml & mvc-servlet.xml 
5. WebContent/WEB-INF create view sub folder to place all jsp

create development process
1. create controller class, normal class with@Controller annotation
2. define controller method 
3. add request mapping to controller method
4. return view name
5. develope view page

package com.example.wenspringmvc;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;

//create controller class
@Controller
public class HomeController {
	
    //create controller method
	@RequestMapping("/")
	public String showPage(){
		//return view
		return "main-menu"; //prefix and suffix will be added according to the config
	}
}

FAQ: HELP! My Spring MVC Controller is not working. What to do?
Section 12, Lecture 103
JUST A HEADS UP ... 

IN THE FOLLOWING VIDEOS YOUR SPRING MVC CONTROLLER CODE MAY NOT WORK

THIS IS AN ECLIPSE CACHING BUG

IF YOUR CONTROLLER DOESN'T WORK THEN TRY THE STEPS BELOW

BE SURE TO COME BACK TO THIS ARTICLE

----

Question:

HELP! My Spring MVC Controller is not working. What to do?

Answer


Debug Tip #1: Make Sure your Package Names is consistent

The Spring configuration file used in the videos expects for your controller to be in the package:

package com.luv2code.springdemo.mvc;

Make sure your controller is this package.
----

Debug Tip #2: Clear Cache

This is normally a caching issue with Eclipse.

Here are some steps to clear the Eclipse cache and Tomcat cache.

1. In the Server's tab in Eclipse, Stop the Tomcat server

2. Right-click the server and select "Clean..."

3. Right-click the server again and select "Clean Tomcat Work Directory..."

---

4. In the Eclipse, select the top-level menu option, Project > Clean ...

5. Be sure your project is selected and click Ok

6. Restart Eclipse

Retest your application. If you continue to have problems try Debug Tip #2

---

Debug Tip #3: Import the Project in  a new workspace




1. Copy your project to a new directory on your computer like, c:\foobar

2. In Eclipse, open a new workspace: Create a new workspace in Eclipse: File > Switch Workspace > Other ... > give any name

3. In Eclipse, import the project 

3a. Use File > Import > General > Existing Projects into Workspace

3b. Browse to directory: c:\foobar

4. In your new workspace, add a reference to the Tomcat server

5. Test your app in the new workspace

---

If you still have problems, then post your code to the classroom discussion forum.

Be sure to include the following files:
- spring-mvc-demo-servlet.xml
- your controller .java
- your view page .jsp

FAQ: HELP! - Can't Start Tomcat - Ports are in Use!
Section 12, Lecture 104
Can't Start Tomcat - Ports are in Use

You may have a problem starting Tomcat. You may see this ugly error message about ports in use.




Solution

You can use the troubleshooting tips below.

Troubleshooting Tip #1

1. Exit Eclipse

2. Open a web web browser and visit, http://localhost:8080

3. If you see a "Tomcat" web page then that means Tomcat is running as a Windows service. To stop Tomcat running as a Windows services, open your Windows Control Panel. Find the service "Apache Tomcat" and stop it.

4. If you don't see a "Tomcat" web page, then stop the appropriate process displayed.

--

Troubleshooting Tip #2

Steps to free port which is already used to run tomcat server in Eclipse

For example , suppose 8080 port is used , we need to make free 8080 to run tomcat

Step 1: (open the CMD command)

C:\Users\username>netstat -o -n -a | findstr 0.0:8080

TCP 0.0.0.0:3000 0.0.0.0:0 LISTENING 3116

Now , we can see that LISTENING port is 3116 for 8080 ,

We need to kill 3116 now

Step 2:-

C:\Users\username>taskkill /F /PID 3116

Step 3: Go to Eclipse and start Server , it will run

Adding data to Spring model

Question

How do I use CSS, JavaScript and Images in a Spring MVC Web App?

Answer

Here are the steps on how to access static resources in a Spring MVC. For example, you can use this to access images, css, JavaScript files etc.

Any static resource is processed as a URL Mapping in Spring MVC. You can configure references to static resources in the spring-mvc-demo-servlet.xml.

In my example, I'm going to have the following directory structure:




I chose to put everything in the "resources" directory. But you can use any name for "resources", such as "assets", "foobar" etc. Also, you can give any name that you want for the subdirectories under "resources".
---

Step 1: Add the following entry to your Spring MVC configuration file: spring-mvc-demo-servlet.xml

You can place this entry anywhere in your Spring MVC config file.

<mvc:resources mapping="/resources/**" location="/resources/"></mvc:resources> 

Step 2: Now in your view pages, you can access the static files using this syntax:

<img src="${pageContext.request.contextPath}/resources/images/spring-logo.png"> 

You need to use the JSP expression ${pageContext.request.contextPath} to access the correct root directory for your web application.

Apply the same technique for reading CSS and JavaScript.

---

Here's a full example that reads CSS, JavaScript and images.

<!DOCTYPE html> <html>

<head>

    <link rel="stylesheet" type="text/css"           

           href="${pageContext.request.contextPath}/resources/css/my-test.css">

    <script src="${pageContext.request.contextPath}/resources/js/simple-test.js"></script>

</head>

<body>

<h2>Spring MVC Demo - Home Page</h2>

<a href="hello">Plain Hello World</a>

<br><br>

<img src="${pageContext.request.contextPath}/resources/images/spring-logo.png" />

<br><br>

<input type="button" onclick="doSomeWork()" value="Click Me"/>

</body>

</html>

---

Source code for this example are available here:

- https://gist.github.com/darbyluv2code/9a09543a226baeedc04b9a5037ca52ec



 
Browse Q&A
Continue


   Show curriculum navigation Go to Dashboard
Questions
Search for a question:
Search for a question
13 questions in this lecture

Ask a new question
 Keh Kok YONG
Cannot find "resources" folder
Hi Crud,I couldn't find the "resources" folder inside my "dynamic web project".  So, I tried creating inside "WebContent" folder or "WEB-INF" folder, it image won't show.By the way, I am using STS 3.9.0 release.Thank you.
Tom Kokkeler
NoHandlerFound
Hi Chad, I am trying to link a stylesheet into my jsp. I use the following line in my jsp to do so: <link rel="stylesheet" type="text/css" href="${pageContext.request.contextPath}/resources/stylesheets/springDemoStylesheet.css"/>  When checking the debug window in Opera the link seems to be all just fine. The problem is that I get an error in Eclipse telling me this: org.springframework.web.servlet.PageNotFound noHandlerFound WARNING: No mapping found for HTTP request with URI [/SpringMVCDemo/resources/stylesheets/springDemoStylesheet.css] in DispatcherServlet with name 'dispatcher' I have added the MVS resource mapping into my xml file <mvc:resources mapping="/resources/**" location="/resources/" /> My folder structure is the same as described:[image]So what am I missing here? Could you help me out? Thank you very much:)
Abhishay Srivastava
Getting Unresolved compilation error. "The method addAttribute(String, String) is undefined for the type Model" code snippet- model.addAttribute("message" , result);
Getting Unresolved compilation error.  "The method addAttribute(String, String) is undefined for the type Model"    code snippet- model.addAttribute("message" , result);
Heer Lalchandani
Background Image
Hi sir, I am not able to put background image in JSP ,this background  image i want to insert through css. in jsp.Please Guide me
Остап Мацько
Another answer
Hi Chad)First of all i must say you "Thank you very much" for your videos.I watched only 150 your videos about Spring(i off course will countinue watch).Thanks to your video now i'm practising on a position trainee JavaDev On "Epam Systems" Compony.I have practising Spring project on Spring now.And my question how i can call methods on a processForm(JSP)? I mean i created some methods on a class Car.java how must i call this methods in jsp and how i can see the result of this methods?What you can recommend in this situation?
Blueocean
static resources shortcut
Hi Chad, quick question regarding the static resources. Alternatively to the spring:url taglib pointed out by Christian, can we use the model to define a shortcut to each resource subfolders, such as: <img src="${images}/spring-logo.png"> where images= pageContext.request.contextPath + "/resources/images" if:<mvc:resources mapping="/resources/**" location="/resources/"></mvc:resources>
Joel Garcia
How to inherit CSS and JS in all the views?
hello teacher, all woks fine, actually i've learned a lot so far! So before of all "THANKS A LOT", but in this lecture I have a question.... im RoR developer and in rails there is something called "partials", also in Laravel exists something called "yield" i suppose that Spring also has something similar, because it isn't a good practice repeat same code in all the views. I mean something like this  <link rel="stylesheet" type="text/css" href="${pageContext.request.contextPath}/resources/css/style.css"> <script src="${pageContext.request.contextPath}/resources/js/event.js"></script>
İsa KÜÇÜKOĞUZ
Are we supposed to know CSS, Javascript and etc. What if we don't ?
Hi Chad,As i asked in the title, are we supposed to know all this stuff other than spring ? or should we learn just the basics ? or what happens if don't know any css or javascript etc ?  because it seems confusing when i look at them first. what do you recommend ?
Sheryl
Why does href in main-menu.jsp have "hello" instead of "ShowForm". it caused a mapping not found error
Ranjen Naidu
How to use CSS , Javascript and Images in Spring MVC Web App using Maven
Hi Chad,I am using Maven. Can you guide me how to use your code you have provided in Section 12 , Lecture 112 in Maven. I have tried and getting the following error:[image]For the full source code you can view from here:https://drive.google.com/open?id=0BzPmevkJwp6yWTRTaElia2lMOXM
Maksym Kolov
Difference between mapping and location
Hi Chad,I cannot make much difference between those two as I tried to use mapping in my jsp page, like this:<img src="${pageContext.request.contextPath}/images/pic.jpg"> and I have the following mvc:resources set up:<mvc:resources mapping="/images/**" location="/img/"></mvc:resources>and it does not work.Documentation is not much of a help either as I have no clue what this means:The URL mapping pattern within the current Servlet context to use for serving resources from this handler, such  as "/resources/**"Any help would be amazing!
Christian Altamirano Ayala
Another Way to import resources
Hi chad, I use in the jsp file the code below, for use CSS, JS, IMG  :) and it works!!.<spring:url value="/resources/bower_components/bootstrap/dist/css/bootstrap.min.css" var="bowerComponent"/>         <spring:url value="/resources/bower_components/metisMenu/dist/metisMenu.min.css" var="metisMenu"/>         <spring:url value="/resources/css/sb-admin-2.css" var="adminsb"/>         <spring:url value="/resources/bower_components/font-awesome/css/font-awesome.min.css" var="font"/>                         <!-- Bootstrap Core CSS -->        <link href="${bowerComponent}" rel="stylesheet">         <!-- MetisMenu CSS -->        <link href="${metisMenu}" rel="stylesheet">         <!-- Custom CSS -->        <link href="${adminsb}" rel="stylesheet">         <!-- Custom Fonts -->        <link href="${font}" rel="stylesheet" type="text/css">previously i have to add <%@taglib prefix="spring" uri="http://www.springframework.org/tags" %>
Carlos Morzan
Upload image or file to images folder in Spring MVC
Hi Chad,Can you let me know how to upload an image or file into the /resources/images/ folder using spring mvc. Thank you.Carlos
Question Details


JUNIT 
eclipse new project->other->maven
junit test case can only be public void and no input param

	@Test
	public void testTruncateAInFirst2Positions_AFirstOne(){
		assertEquals("CD",helper.truncateAInFirst2Positions("ACD"));
	}
	@Test
	public void testAreFirstAndLastTwoCharactersTheSame(){
		//assertEquals(false, );	
		assertFalse(helper.areFirstAndLastTwoCharactersTheSame("ABCD"));
	}
		@Test
	public void testAreFirstAndLastTwoCharactersTheSame_ABAB(){
		assertTrue(helper.areFirstAndLastTwoCharactersTheSame("ABAB"));
	}

	//before method will be executed before every test method runs
	@Before
	public void setup(){
		System.out.println("@before: set up");
	}
	//after method run after every test finish
	@After
	public void afterMethod(){
		System.out.println("@after: clean up");
	}
	//execute once before the tests
	@BeforeClass
	public static void beforeClass(){
		System.out.println("before class");
	}//execute once after the tests
	@AfterClass
	public static void afterClass(){
		System.out.println("after class");
	}
     //compare two objects
      //compare the same object, same memory address assertEquals();
	assertArrayEquals(expected,numbers); 
//test for exceptions
@Test
	public void testNull(){
		int [] number = null;
		try{
			Arrays.sort(number);
		}catch(NullPointerException e){
			//success case
		}
	}

	@Test(expected = NullPointerException.class)
	public void testNull(){
		int [] number = null;	
		Arrays.sort(number);
	}
//test for performance
	@Test(timeout = 67)
	public void arraySort_Performance(){
		int [] numbers = {5,10,5};
		for(int i = 0; i < 1000000; i++){
			numbers[0] = i;
			Arrays.sort(numbers);
		}
	}
//parameterized junit testing
@RunWith(Parameterized.class)
public class ParametizedStringHelperTest {
   
	StringHelper helper = new StringHelper();
	private String input;
	private String expectedOutput;
	
	public ParametizedStringHelperTest(String input, String expectedOutput) {
		super();
		this.input = input;
		this.expectedOutput = expectedOutput;
	}
	@Parameters
	public static Collection<String[]> parameterizedTest(){
		String expected [][] = {{"AAD","CD"},
		{"ACD","CD"}};		
		return Arrays.asList(expected);
	}

	@Test
	public void testTruncateAInFirst2Positions_AFirstOne(){
		assertEquals(expectedOutput,helper.truncateAInFirst2Positions(input));
	}

}
Test suite is used to bundle a few unit test cases and run them together. In JUnit, both @RunWith and @Suite annotations are used to run the suite tests.
NEW->TEST SUITE
@RunWith(Suite.class)
@SuiteClasses({ JavaArraysTest.class, ParametizedStringHelperTest.class })
public class AllTests {

}

JUnit Best Practices

Naming Test Methods
Highlight Important Values in Tests
Handle Exceptions Properly
Readable Assert Statements


Hibernate: a framework for persisting/saving/retrieving java objects in a datebase
1. handle all the low-level SQL
2. minimize the amount of JDBC code
3. provides object to relational mapping(ORM)

developers defines mapping between java classes and database table
map object fields to columns in db table via config
//create a object
Student studentJohn = new Student("John","Doe","jdoe@gmail.com");
//save the objec to dab
int identry = session.save(studentJohn);
//retrieve object from db
Student student = session.get(Student.class, identry);
//return the table as a list
//Hibernate Query language
Query query = session.createQuery("from Student");
List<Student> students = query.list();

Hibernate vs JDBC
hibernate uses JDBC for all dabtabase communications

Raw Servlet vs. Spring MVC
If you're building a really quick and dirty demo that you have no intention of extending later, spring can result in a lot of additional configuration issues (not really if you've done it before, but I always end up fighting with it one way or another), so that might be a time to consider just using plain old servlets. Generally though, anything beyond just a super fast and dirty demo, using some form of MVC framework is going to make life in the future a lot easier and is also in line with best practices. Spring makes things super easy, just have to spend some time on the front end configuring everything.

I should note, there's nothing you can do with java servlets that you can't do with Spring. The big difference is setup time.

Edit: It's worth noting that when I posted this answer, I was unaware of Spring Boot that is actually quite easy to get up an running using either an embedded web server or a more conventional web container. Here's a link to a quick start example: http://projects.spring.io/spring-boot/#quick-start

Spring  bind requestParam with variables
	//annotation request param binding
	//pass studentname value to variable String studentName
	@RequestMapping("/processFormVersionThree")
	public String lesshoutDude(@RequestParam("studentname") String studentName, Model model){
		studentName = studentName.toUpperCase();
		String message = "Yo Yo! "+studentName;
		model.addAttribute("message", message);		
		return "helloworld-confirm";
	}

Controller level/parent request mapping (similar idea like a file system folder)
1. organise request mapping within one controller
2. sovle eventual naming conflits of mapping request
<a href = "helloworld/showForm">Hello World Form</a>
@Controller
@RequestMapping("/helloworld")
public class HelloWorldController {
	@RequestMapping("/showForm")
	public String showForm(){



Spring MVC form 
1. building blocks of web pages
2. form tags are configurable and reusable
3. support data binding
4. automatically setting and retrieving data from a java object/bean
5. form tags will generate html for developer

<%@taglib uri="http://www.springframework.org/tags/form" prefix="form" %>
when spring mvc load form: getter methods will be called
when spring submit form: setter methods will be called

@Controller
@RequestMapping("/student")
public class StudentController {
	
	@RequestMapping("/showForm")
	public String showForm(Model model){
		//create new student object
		Student theStudent = new Student();		
		//add student as model attribute
		model.addAttribute("student", theStudent);
		return "student-form";
		
	}
    //ModelAttribute pass data to theStudent
	@RequestMapping("/processForm")
	public String processForm(@ModelAttribute("student") Student theStudent){
		
		System.out.println("the student: "+theStudent.getFirstName()+" "+theStudent.getLastName());
		//data automatically binded
		return "student-confirmation";
	}

}
    // <form:form> not standard form; path to ensure the auto bind
	<form:form action="processForm" modelAttribute="student">
        First Name: <form:input path="firstName" />
		<br /><br />
        Last Name:<form:input path="lastName" />
		<br /><br />
		<input type="submit" />
	</form:form>

		//here populate the drop down list from this  hashmap field
		countryOptions = new LinkedHashMap<> ();
		countryOptions.put("FR", "France");
		countryOptions.put("DE", "German");
		countryOptions.put("BR", "Brazil");
	}
	public LinkedHashMap<String, String> getCountryOptions() {
		return countryOptions;
	}
	//Drop down button
		<form:select path = "country">
		 	<form:options items = "${student.countryOptions}"/>	
		</form:select>

Question: 

How to use properties file to load country options

Answer:

This solution will show you how to place the country options in a properties file. The values will no longer be hard coded in the Java code.

1. Create a properties file to hold the countries. It will be a name value pair.  Country code is name. Country name is the value.

New text file:  WEB-INF/countries.properties

BR=Brazil 
FR=France 
CO=Colombia 
IN=India
Note the location of the properties file is very important. It must be stored in WEB-INF/countries.properties

2. Update header section for Spring config file

We are going to use a new set of Spring tags for <util>. As a result, you need to update the header information in the Spring config file.

File: spring-mvc-dmo-servlet.xml

Remove the previous header and add this.

<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" 
        xmlns:context="http://www.springframework.org/schema/context" 
        xmlns:mvc="http://www.springframework.org/schema/mvc" 
        xmlns:util="http://www.springframework.org/schema/util" 
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
        xsi:schemaLocation="
            http://www.springframework.org/schema/beans     
            http://www.springframework.org/schema/beans/spring-beans.xsd     
            http://www.springframework.org/schema/context     
            http://www.springframework.org/schema/context/spring-context.xsd     
            http://www.springframework.org/schema/mvc         
            http://www.springframework.org/schema/mvc/spring-mvc.xsd 
            http://www.springframework.org/schema/util     
            http://www.springframework.org/schema/util/spring-util.xsd">
3. Load the country options properties file in the Spring config file. Bean id: countryOptions

File: spring-mvc-dmo-servlet.xml

Add the following lines:

<util:properties id="countryOptions" location="classpath:../countries.properties" /> 

4. Inject the properties values into your Spring Controller: StudentController.java

@Value("#{countryOptions}") 
private Map<String, String> countryOptions;
5. Add the country options to the Spring MVC model. Attribute name: theCountryOptions

@RequestMapping("/showForm") 
public String showForm(Model theModel) { 
 
    // create a student object Student 
    Student theStudent = new Student();
 
    // add student object to the model 
    theModel.addAttribute("student", theStudent); 
 
    // add the country options to the model 
    theModel.addAttribute("theCountryOptions", countryOptions); 
 
    return "student-form"; 
}
6. Update the JSP page, student-form.jsp, to use the new model attribute for the drop-down list: theCountryOptions

<form:select path="country"> 
 <form:options items="${theCountryOptions}" />
</form:select>
7. Remove all references to country option from your Student.java.  

---

DOWNLOAD FULL SOURCE CODE

You can download entire code from here:

- http://www.luv2code.com/downloads/spring-hibernate/spring-props-mvc-demo.zip
//radio button
		Favorite Language: 
		Java <form:radiobutton path = "favoriteLanguage" value = "Java"/> 
		C# <form:radiobutton path = "favoriteLanguage" value = "C#"/>
		C++ <form:radiobutton path = "favoriteLanguage" value = "C++"/>
		PHP <form:radiobutton path = "favoriteLanguage" value = "PHP"/>



		//populate radio button with options
		favoriteLanguageOptions= new LinkedHashMap<>();
		favoriteLanguageOptions.put("Java", "Java");
		favoriteLanguageOptions.put("C#", "C#");
		favoriteLanguageOptions.put("C++", "C++");
		favoriteLanguageOptions.put("PHP", "PHP");
				Favorite Language: 
		 <form:radiobuttons path="favoriteLanguage"  items = "${student.favoriteLanguageOptions}"/> 
Operating Systems:
	<ul>
		<c:forEach var="tempOS" items="${student.operatingSystems}">
			<li>tempOS</li>
		</c:forEach>
	</ul>
	private String[] operatingSystems;

	public String[] getOperatingSystems() {
		return operatingSystems;
	}
	public void setOperatingSystems(String[] operatingSystems) {
		this.operatingSystems = operatingSystems;
	}
Java standard bean validation api (JSR 303 -309)
support both client side and server side
Spring v4 and later support bean validation api 
1. required
2. validate length
3. validate numbers
4. validate with regular expression
5. custom validation

hibernate validator: seperate project, fully compile with java validation api
add to web info ->lib
1. three jars from dist/
2. four jars from dist/lib/required
then performing Spring MVC validation, the location of the BindingResult parameter is very important. In the method signature, the BindingResult parameter must immediately after the model attribute. 

If you place it in any other location, Spring MVC validation will not work as desired. In fact, your validation rules will be ignored.

        @RequestMapping("/processForm")
        public String processForm(
                @Valid @ModelAttribute("customer") Customer theCustomer,
                BindingResult theBindingResult) {
            ...            
        }
Here is the relevant section from the Spring Reference Manual

---

22.3.3 Defining @RequestMapping handler methods


@RequestMapping handler methods can have very flexible signatures. The supported method arguments and return values are described in the following section. Most arguments can be used in arbitrary order with the only exception being BindingResult arguments.


The Errors or BindingResult parameters have to follow the model object that is being
bound immediately ...

Source: http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-ann-methods

	//validation rules to Customer class 
	@NotNull(message = "Last Name is required")
	@Size(min =1, message = "is required")
	private String lastName;

	//display erro message on the HTML form
	    Please fill up following form, * are required.
	<form:form action="processForm" modelAttribute="customer">
        First Name : <form:input path="firstName" />
		<br />
        Last Name (*): <form:input path="lastName" />
		<form:errors path="lastName"/>
		<br />
		<input type="submit" value="Submit" />
	</form:form>
		//Spring store validate result in BindingResult
	public String processForm(@Valid @ModelAttribute("customer") Customer customer,
			BindingResult bindingResult){
		if (bindingResult.hasErrors()){
			return "customer-form";
		}else{
			return "customer-confirm";
		}
		
	}

@InitBinder annotation works as a pre processor
it will pre process every web request to the current controller
method annotated with @InitBinder is excuted

	@InitBinder
	public void initBinder(WebDataBinder dataBinder){
		StringTrimmerEditor editor = new StringTrimmerEditor(true); //trim till null
		dataBinder.registerCustomEditor(String.class, editor);//for all comming String data, apply this 
	}

@Min(value = 0, message = "must be greater than or equal to zero")
	@Max(value = 10, message = "must be less than or equal to ten")
	private int freePasses;

        Last Name (*): <form:input path="lastName" />
		<form:errors path="lastName" cssClass = "error"/>
		<br /><br />
		Free Pass:<form:input path = "freePasses"/>
		<form:errors path = "freePasses" cssClass = "error"/>
Regular Expressions
1. a sequence of characters that define a search patter
2. could be used to find or match strings
	
	@Pattern(regexp = "^[a-zA-Z0-9]{5}",message = "only 5 chars or digits")
	private String postalCode;

	@NotNull(message = "Free passes is required")
	@Min(value = 0, message = "must be greater than or equal to zero")
	@Max(value = 10, message = "must be less than or equal to ten")	
	private Integer freePasses;

Creating custom error message:
1. create a new folder under src 
	<!-- load custom error messages -->
    <bean id = "messageSource"
    class = "org.springframework.context.support.ResourceBundleMessageSource">
    	<property name="basenames" value = "resources/messages"></property>
    </bean>
    //override default erro message
    typeMismatch.customer.freePasses = Invalid Number

bindingResult: org.springframework.validation.BeanPropertyBindingResult: 1 errors
Field error in object 'customer' on field 'freePasses': rejected value [xxxdd]; codes [typeMismatch.customer.freePasses,typeMismatch.freePasses,typeMismatch.java.lang.Integer,typeMismatch]; arguments [org.springframework.context.support.DefaultMessageSourceResolvable: codes [customer.freePasses,freePasses]; arguments []; default message [freePasses]]; default message [Failed to convert property value of type 'java.lang.String' to required type 'java.lang.Integer' for property 'freePasses'; nested exception is java.lang.NumberFormatException: For input string: "xxxdd"]

Custom validation
create custom java annotation
eclipse new->annotation
@Constraint(validatedBy = CourseCodeConstraintValidator.class)
@Target({ ElementType.METHOD,ElementType.FIELD })
@Retention(RetentionPolicy.RUNTIME)
public @interface CourseCode {
	//define default value
	public String value() default "LUV";
	//define default error message
	public String message() default "must start with LUV";
	//define default groups
	public Class<?>[] groups() default {};
	//define default payloads
	public Class <? extends Payload> [] payload() default {};

}
public class CourseCodeConstraintValidator implements ConstraintValidator<CourseCode, String> {
	private String coursePrefix;
	@Override
	public void initialize(CourseCode courseCode){
		coursePrefix = courseCode.value();
	}

	@Override
	public boolean isValid(String coursename, ConstraintValidatorContext constrainValidationContext) {
		// TODO Auto-generated method stub
		return coursename.startsWith(coursePrefix);
	}	
}
	@CourseCode
	private String courseCode;

Spring MVC Custom Validation - FAQ: Is it possible to integrate multiple validation string in one annotation?



Question:

Is it possible to integrate multiple validation string in one annotation? For example, validate against both LUV and TOPS.

Answer:

Yes, you can do this. In your validation, you will make use of an array of strings.

Here's an overview of the steps.

1. Update CourseCode.java to use an array of strings

2. Update CourseCodeConstraintValidator.java to validate against array of strings

3. Update Customer.java to validate using array of strings

---

Detailed Steps

1. Update CourseCode.java to use an array of strings

Change the value entry to an array of Strings:

    // define default course code
    public String[] value() default {"LUV"};
Note the use of square brackets for the array of Strings. Also, the initialized value uses curley-braces for array data.

2. Update CourseCodeConstraintValidator.java to validate against array of strings

Change the field for coursePrefixes to an array

private String[] coursePrefixes; 

Update the isValid(...) method to loop through the course prefixes. In the loop, check to see if the code matches any of the course prefixes.

    @Override
    public boolean isValid(String theCode, 
                        ConstraintValidatorContext theConstraintValidatorContext) {
        boolean result = false;
        
        if (theCode != null) {
            
            //
            // loop thru course prefixes
            //
            // check to see if code matches any of the course prefixes
            //
            for (String tempPrefix : coursePrefixes) {
                result = theCode.startsWith(tempPrefix);
                
                // if we found a match then break out of the loop
                if (result) {
                    break;
                }
            }
        }
        else {
            result = true;
        }
        
        return result;
  }
3. Update Customer.java to validate using array of strings

    @CourseCode(value={"TOPS", "LUV"}, message="must start with TOPS or LUV")
    private String courseCode;
Note the use of curley braces.

---

Complete Source Code:

https://gist.github.com/darbyluv2code/0275ddb6e70e085a10fd464e36a42739

---

That's it. This provides a solution to integrate multiple validation string in one annotation. In this example, the code validates against both LUV and TOPS.



hibernate use jdbc in the background for communicationg with db, a higher level of abstraction
Hibernate development setup
1. IDE like Eclipse
2. Database like mySql (download msi install file, set up password)
3. Hibernate jar files and JDBC driver copy to project/lib folder and add to java build path
download hibernate-release-.zip
lib->required(15items)->eclipse project->lib
4. config file project->src
MySQL Connectors->connectors/j->independent zip file->mysql-connector-java.jar
project->properties->java build path->libary->add jars->ok->jars will be at the folder of referenced libraries
        //java.sql.DriverManager.getConnection using url, user and password
    	String jdbcurl = "jdbc:mysql://localhost:3306/hb_student_tracker?useSSL=false";
    	String user = "hbstudent";
    	String pass = "hbstudent";
    	System.out.println("connection to db");
    	Connection conn = DriverManager.getConnection(jdbcurl,user,pass);
    	System.out.println("connection granted");

hibernate.cfg.xml
<hibernate-configuration>

    <session-factory>

        <!-- JDBC Database connection settings -->
        <property name="connection.driver_class">com.mysql.jdbc.Driver</property>
        <property name="connection.url">jdbc:mysql://localhost:3306/hb_student_tracker?useSSL=false</property>
        <property name="connection.username">hbstudent</property>
        <property name="connection.password">hbstudent</property>

        <!-- JDBC connection pool settings ... using built-in test pool -->
        <property name="connection.pool_size">1</property>

        <!-- Select our SQL dialect -->
        <property name="dialect">org.hibernate.dialect.MySQLDialect</property>

        <!-- Echo the SQL to stdout -->
        <property name="show_sql">true</property>

		<!-- Set the current session context -->
		<property name="current_session_context_class">thread</property>
 
    </session-factory>

</hibernate-configuration>

Entity: java class that is mapped to a db table
Object-to-Relational Mapping(ORM)
Two options for mapping
1. XML config(legacy)
2. java annoation(modern) a.map class to database table (@Entity @Table(name = "student"))2. map fields to db table column(@Column(name = "x"))

QUESTION:
Why we are using JPA Annotation instead of Hibernate ?

For example, why we are not using this org.hibernate.annotations.Entity?

ANSWER:
JPA is a standard specification. Hibernate is an implementation of the JPA specification.

Hibernate implements all of the JPA annotations.

The Hibernate team recommends the use of JPA annotations as a best practice.

import javax.persistence.Column;
import javax.persistence.Entity;
import javax.persistence.Id;
import javax.persistence.Table;

@Entity
@Table(name = "student")
public class Student {	
	@Id
	@Column(name = "id")
	private int id;
	@Column(name = "first_name")
	private String firstName;
	@Column(name = "last_name")
	private String lastName;
	@Column(name = "email")
	private String email;
	public Student(){
		
	}
	public Student(String firstName, String lastName, String email) {
		
		this.firstName = firstName;
		this.lastName = lastName;
		this.email = email;
	}
	public int getId() {
		return id;
	}
	public void setId(int id) {
		this.id = id;
	}
	public String getFirstName() {
		return firstName;
	}
	public void setFirstName(String firstName) {
		this.firstName = firstName;
	}
	public String getLastName() {
		return lastName;
	}
	public void setLastName(String lastName) {
		this.lastName = lastName;
	}
	public String getEmail() {
		return email;
	}
	public void setEmail(String email) {
		this.email = email;
	}
	//for debugging purpose
	@Override
	public String toString() {
		return "Student [id=" + id + ", firstName=" + firstName + ", lastName=" + lastName + ", email=" + email + "]";
	}
	
}
SessionFactory: 
1. read hibernate config file
2. create session objects
3. heavy-weigh object 
4. only create once in the app

session:
1. wraps a JDBC connection
2. main object used to save/retrieve objects
3. short-lived object
4. retrieve from session factory

public class HibernateDemo {

	public static void main(String[] args) {
		//create session factory based on config file and db table
		SessionFactory factory = new Configuration()
				.configure("hibernate.cfg.xml")
				.addAnnotatedClass(Student.class)
				.buildSessionFactory();
		//create session
		Session session = factory.getCurrentSession();
		try{
			//use the session to save java object			
			//create Student object
			Student student = new Student("Wen","Zhao","wen@gmail.com");
			//start a transaction
			session.beginTransaction();
			//save the student object
			session.save(student);
			System.out.println("saving the student object...");
			//commit the transaction
			session.getTransaction().commit();
			System.out.println("save sucessfully!");
		}finally{
			factory.close();
		}

	}

}

primary key: 
uniquely identifies each row in a table
must be a unique 
can not be null

@GeneratedValue(strategy = GenerationType.IDENTITY) //most common type for mysql
it is possible to custom generation strategy
1. create subclass of sequencegenerator
2. override the method public Serializable generate() //write custom generation logic

You can use ALTER TABLE to change the auto_increment initial value:

ALTER TABLE tbl AUTO_INCREMENT = 5;
TRUNCATE TABLE statement to remove all rows from a table and reset the auto_increment rules

to retrieve a object from table, session.get(class,primarykeyid)

			//start transaction
			session = factory.getCurrentSession();
			session.beginTransaction();
			//retrieve the object
			Student temp = session.get(Student.class, student.getId());
			//commit
			session.getTransaction().commit();

Hibernate Query Language (HQL) is an object-oriented query language, similar to SQL, but instead of operating on tables and columns, HQL works with persistent objects and their properties. 
//from Student which is the class not the table
List<Student> students = session.createQuery("from Student").getResultList();
students = session.createQuery("from Student s where s.lastName = 'Lee'").getResultList();
students = session.createQuery("from Student s where s.email like '%gmail.com'").getResultList();
students = session.createQuery("from Student s where s.lastName = 'Lee' or s.firstName = 'sally'").getResultList();

Section: 1
7 / 7
Course Introduction
Section: 2
5 / 5
Spring Overview
Section: 3
7 / 7
Setting Up Your Development Environment
Section: 4
8 / 8
Spring Inversion of Control - XML Configuration
Section: 5
15 / 15
Spring Dependency Injection - XML Configuration
Section: 6
8 / 8
Spring Bean Scopes and Lifecycle
Section: 7
7 / 7
Spring Configuration with Java Annotations - Inversion of Control
Section: 8
18 / 18
Spring Configuration with Java Annotations - Dependency Injection
Section: 9
6 / 6
Spring Configuration with Java Annotations - Bean Scopes and Lifecycle Methods
Section: 10
10 / 10
Spring Configuration with Java Code
Section: 11
8 / 8
Spring MVC - Building Spring Web Apps
Section: 12
15 / 15
Spring MVC - Creating Controllers and Views
Section: 13
6 / 6
Spring MVC - Request Params and Request Mappings
Section: 14
15 / 15
Spring MVC - Form Tags and Data Binding
Section: 15
13 / 13
Spring MVC Form Validation - Applying Built-In Validation Rules
Section: 16
9 / 9
Spring MVC Form Validation - Validating Number Ranges and Regular Expressions
Section: 17
8 / 8
Spring MVC Form Validation - Creating Custom Validation Rules
Section: 18
2 / 2
Introduction to Hibernate
Section: 19
7 / 7
Setting Up Hibernate Development Environment
Section: 20
5 / 5
Hibernate Configuration with Annotations
Section: 21
11 / 17
Hibernate CRUD Features: Create, Read, Update and Delete
Section: 22
0 / 2
Hibernate Advanced Mappings
Section: 23
0 / 17
Hibernate Advanced Mappings - @OneToOne
Section: 24
0 / 10
Hibernate Advanced Mappings - @OneToMany
Section: 25
0 / 8
Hibernate Advanced Mappings - Eager vs Lazy Loading
Section: 26
0 / 8
Hibernate Advanced Mappings - @OneToMany - Unidirectional
Section: 27
0 / 13
Hibernate Advanced Mappings - @ManyToMany
Section: 28
0 / 9
Build a Database Web App - Spring MVC and Hibernate Project - Part 1
Section: 29
0 / 14
Build a Database Web App - Spring MVC and Hibernate Project - Part 2
Section: 30
0 / 5
Build a Database Web App - Spring MVC and Hibernate Project - Part 3
Section: 31
0 / 9
Build a Database Web App - Spring MVC and Hibernate Project - Part 4
Section: 32
0 / 7
Build a Database Web App - Spring MVC and Hibernate Project - Part 5
Section: 33
0 / 6
Build a Database Web App - Spring MVC and Hibernate Project - Part 6
Section: 34
0 / 5
AOP: Aspect-Oriented Programming Overview
Section: 35
0 / 8
AOP: @Before Advice Type
Section: 36
0 / 7
AOP: Pointcut Expressions - Match Methods and Return Types
Section: 37
0 / 5
AOP: Pointcut Expressions - Match Method Parameter Types
Section: 38
0 / 6
AOP: Pointcut Declarations
Section: 39
0 / 4
AOP: Ordering Aspects
Section: 40
0 / 3
AOP: JoinPoints
Section: 41
0 / 9
AOP: @AfterReturning Advice Type
Section: 42
0 / 4
AOP: @AfterThrowing Advice Type
Section: 43
0 / 3
AOP: @After Advice Type
Section: 44
0 / 11
AOP: @Around Advice Type
Section: 45
0 / 7
AOP: Add AOP Logging to Spring MVC App
Section: 46
0 / 3
Summary
Section: 47
0 / 2
Discount Coupons for More of My Java Training
Section: 48
0 / 6
Appendix
We're testing captions for this lecture
Give your opinion
FAQ: How To View Hibernate SQL Parameter Values
Section 21, Lecture 190
FAQ: How To View Hibernate SQL Parameter Values

Question:

I see hibernate printing out the query parameters as ? in the console. 
Is it possible to printout the value that was actually queried on the 
database. Asking as this would help in the debugging purpose.

Answer:

When using Hibernate, if you log the Hibernate SQL statements, you will see this:

Hibernate: insert into student (email, first_name, last_name, id) values (?, ?, ?, ?)

However, for debugging your application, you want to see the actual parameter values in the Hibernate logs. Basically, you want to get rid of the question marks in the Hibernate logs.

You can view the actual parameters by viewing the low-level trace of the Hibernate logs. This is not set up by default. However, we can add log4j to allow us to see these low-level logs.



Here is an overview of the process:
1. Add log4j to your project classpath 

2. Add log4j.properties to your “src” directory



Here are the detailed steps:
1. Add log4j to your project classpath

1a. Download log4j v1.2.17 from this link: – http://central.maven.org/maven2/log4j/log4j/1.2.17/log4j-1.2.17.jar

1b. Copy this file to your project’s lib directory




1c. Right-click your Eclipse project and select Properties

1d. Select Build Path > Libraries > Add JARS…

1e. Select the log4j-1.2.17.jar file from the lib directory




2. Add log4j.properties to your “src” directory

2a. Copy the text from below

# Root logger option
log4j.rootLogger=DEBUG, stdout
 
# Redirect log messages to console
log4j.appender.stdout=org.apache.log4j.ConsoleAppender
log4j.appender.stdout.Target=System.out
log4j.appender.stdout.layout=org.apache.log4j.PatternLayout
log4j.appender.stdout.layout.ConversionPattern=%d{yyyy-MM-dd HH:mm:ss} %-5p %c{1}:%L - %m%n
 
log4j.logger.org.hibernate=TRACE
2b. Save this file as "log4j.properties" in your “src” directory




Note: This file has an important setting:

log4j.logger.org.hibernate=TRACE 

This allows you see a low-level trace of Hibernate and this allows you see the real SQL parameter values.

Now run your application. You will see a lot of low-level TRACE logs in the Eclipse Console window.

Right-click in the Eclipse Console window and select Find/Replace…

Search for: binding parameter

or search for: extracted value

(the search string changes depending on which version of Hibernate you are using)

You will see the logs with the real parameter values. Congrats!

hibernate update one object :
		try{
			int studentId = 3;
			session.beginTransaction();
			Student student = session.get(Student.class, studentId);
			student.setFirstName("bonde");
			session.getTransaction().commit();
update multi rows:
session.createQuery("UPDATE Student set email = 'foo@gmail.com' where id > 2 and id <4").executeUpdate();

		try{
			int studentId = 3;
			session.beginTransaction();
			//retrieve the object 
			Student student = session.get(Student.class, studentId);
			System.out.println("the object about to be deleted: "+student);
			//delete the object
			session.delete(student);
			session.getTransaction().commit();
		}finally{
			factory.close();
		}

	try{
			
			session.beginTransaction();
			//delete the object
			session.createQuery("DELETE FROM Student s where s.id = 4").executeUpdate();
			session.getTransaction().commit();

//create user and grant the privileges
CREATE USER 'webstudent'@'localhost' IDENTIFIED BY 'webstudent';

GRANT ALL PRIVILEGES ON * . * TO 'webstudent'@'localhost';

//create db and table

CREATE DATABASE  IF NOT EXISTS `hb_student_tracker`;
USE `hb_student_tracker`;

--
-- Table structure for table `student`
--

DROP TABLE IF EXISTS `student`;

CREATE TABLE `student` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `first_name` varchar(45) DEFAULT NULL,
  `last_name` varchar(45) DEFAULT NULL,
  `email` varchar(45) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=latin1;

Practice Activity #8 - Hibernate Development

 

Overview

Create an app using Hibernate to read/write data to database table. Here is the database table design:

Table: Employee

Columns
- first_name : varchar
- last_name: varchar
- company : varchar


Steps You Must Complete 

Create the database table.
Set up the Hibernate configuration file.
Create a Java class (entity) with Hibernate annotations.
Develop a main application.
Develop code to save objects.
Develop code to retrieve an object by primary key.
Develop code to query objects to find employees for a given company.
Develop code to delete an object by primary key.
FAQ: How to read Dates with Hibernate
Section 21, Lecture 196
FAQ: Handling Dates with Hibernate

How can I read date strings from the command-line and store them as dates in the database?

Answer:

You can make use of a combination of Java's date formatting class and Hibernate annotations.

Sample output:

Student [id=50, firstName=Paul, lastName=Doe, email=paul@luv2code.com, dateOfBirth=null]
Student [id=51, firstName=Daffy, lastName=Duck, email=daffy@luv2code.com, dateOfBirth=null]
Student [id=52, firstName=Paul, lastName=Doe, email=paul@luv.com, dateOfBirth=31/12/1998]

Development Process Overview

1. Alter database table for student
2. Add a date utils class for parsing and formatting dates
3. Add date field to Student class
4. Add toString method to Student class
5. Update CreateStudentDemo

----

Detailed steps

1. Alter database table for student

We need to alter the database table to add a new column for "date_of_birth".

Run the following SQL in your MySQL Workbench tool.

ALTER TABLE `hb_student_tracker`.`student` 
ADD COLUMN `date_of_birth` DATETIME NULL AFTER `last_name`;
--

2. Add a date utils class for parsing and formatting dates

We need to add a DateUtils class to handle parsing and formatting dates. The source code is here. The class should be placed in the package: com.luv2code.hibernate.demo.

The date formatter uses special symbols for formatting/parsing.

-  dd:  day in month (number)
-  MM:  month in year (number)
- yyyy: year

See this link for details: https://docs.oracle.com/javase/tutorial/i18n/format/simpleDateFormat.html

package com.luv2code.hibernate.demo;
 
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.Date;
 
public class DateUtils {
    
    // The date formatter
    // - dd:   day in month (number)
    // - MM:   month in year (number)
    // - yyyy: year
    //
    // See this link for details: https://docs.oracle.com/javase/tutorial/i18n/format/simpleDateFormat.html
    //
    //
    private static SimpleDateFormat formatter = new SimpleDateFormat("dd/MM/yyyy");
    
    // read a date string and parse/convert to a date
    public static Date parseDate(String dateStr) throws ParseException {
        Date theDate = formatter.parse(dateStr);
        
        return theDate;        
    }
    
    // read a date and format/convert to a string
    public static String formatDate(Date theDate) {
        
        String result = null;
        
        if (theDate != null) {
            result = formatter.format(theDate);
        }
        
        return result;
    }
}
---

3. Add date field to Student class

We need to add a date field to the Student class. We map this field to the database column, "date_of_birth". Also, we make use of the @Temporal annotation. This is a Java annotation for storing dates.

    @Column(name="date_of_birth")
    @Temporal(TemporalType.DATE)    
    private Date dateOfBirth;
Here's the full source code.

---

package com.luv2code.hibernate.demo.entity;

import java.util.Date;

import javax.persistence.Column;
import javax.persistence.Entity;
import javax.persistence.Id;
import javax.persistence.Table;
import javax.persistence.Temporal;
import javax.persistence.TemporalType;

import com.luv2code.hibernate.demo.DateUtils;

@Entity
@Table(name="student")
public class Student {
    
    @Id
    @Column(name="id")
    private int id;
    
    @Column(name="first_name")
    private String firstName;
    
    @Column(name="last_name")
    private String lastName;
    
    @Column(name="email")
    private String email;
    
    @Column(name="date_of_birth")
    @Temporal(TemporalType.DATE)    
    private Date dateOfBirth;
    
    public Student() {
        
    }

    public Student( String firstName, String lastName, String email, Date theDateOfBirth) {
        
        this.firstName = firstName;
        this.lastName = lastName;
        this.email = email;
        this.dateOfBirth = theDateOfBirth;
        
    }

    public int getId() {
        return id;
    }

    public void setId(int id) {
        this.id = id;
    }

    public String getFirstName() {
        return firstName;
    }

    public void setFirstName(String firstName) {
        this.firstName = firstName;
    }

    public String getLastName() {
        return lastName;
    }

    public void setLastName(String lastName) {
        this.lastName = lastName;
    }

    public String getEmail() {
        return email;
    }

    public void setEmail(String email) {
        this.email = email;
    }

    public Date getDateOfBirth() {
        return dateOfBirth;
    }

    public void setDateOfBirth(Date dateOfBirth) {
        this.dateOfBirth = dateOfBirth;
    }

    @Override
    public String toString() {
        return "Student [id=" + id + ", firstName=" + firstName + ", lastName=" + lastName + ", email=" + email
                + ", dateOfBirth=" + DateUtils.formatDate(dateOfBirth) + "]";
    }
        
}

---

4. Add toString method to Student class

We will make an update to the toString method in our Student class.  It will use the formatter from our DateUtils.class. This code is already included in Student.java from the previous step. I'm just highlighting it here for clarity.

        return "Student [id=" + id + ", firstName=" + firstName + ", lastName=" + lastName + ", email=" + email
                + ", dateOfBirth=" + DateUtils.formatDate(dateOfBirth) + "]";
Note the use of DateUtils above.

---

5. Update CreateStudentDemo

Now for the grand finale. In the main program, read the date as a String and parse/convert it to a date. Here's the snippet of code.

            String theDateOfBirthStr = "31/12/1998";
            Date theDateOfBirth = DateUtils.parseDate(theDateOfBirthStr);
            
            Student temoStudent = new Student("Paully", "Doe", "paul@luv.com", theDateOfBirth);
Here's the full code:

package com.luv2code.hibernate.demo;
 
import java.text.ParseException;
import java.util.Date;
import org.hibernate.Session;
import org.hibernate.SessionFactory;
import org.hibernate.cfg.Configuration;
import com.luv2code.hibernate.demo.entity.Student;
 
public class CreateStudentDemo {
 
    public static void main(String[] args) {
        
        // create session factory
        SessionFactory factory = new Configuration().configure("hibernate.cfg.xml").addAnnotatedClass(Student.class)
                .buildSessionFactory();
 
        // create a session
        Session session = factory.getCurrentSession();
 
        try {
            // create a student object
            System.out.println("creating a new student object ...");
 
            String theDateOfBirthStr = "31/12/1998";
 
            Date theDateOfBirth = DateUtils.parseDate(theDateOfBirthStr);
 
            Student temoStudent = new Student("Paully", "Doe", "paul@luv.com", theDateOfBirth);
 
            // start transaction
            session.beginTransaction();
 
            // save the student object
            System.out.println("Saving the student ...");
            session.save(temoStudent);
 
            // commit transaction
            session.getTransaction().commit();
 
            System.out.println("Success!");
        } catch (Exception exc) {
            exc.printStackTrace();
        } finally {
            factory.close();
        }
    }
    
    Hibernate Advance Mappings
    1. multiple tables 
    2. different realtions in between tables

    one to one mapping

    
code is simple, easy to understand and easy to maintain

Build an MVC app with servlet ,jsp and jdbc
1. create employee class 
2. create employee utils for CRUDs
3. create db table 
4.META-INFO-> context.xml config jdbc


1. create student class
2. create user, db and table to represent this class 
3. test jdbc connection->util class to connect to db and operate CRUDs
4. controller servlet (@Resource & dataSource, overide doget & dopost,empty contructor and init())
5. jsp render data (Serverlet RequestDispatcher)
6. html collect user input

Annotation @WebServlet("/Hello") is enough for Tomcat 7+
custom servlet implements HttpServlet, need to override doGet doPost, contructor(),constructor(datesource)

META-INFO/context.xml
<Context>

  <Resource name="jdbc/websupermarketproduct_tracker" 
  			auth="Container" type="javax.sql.DataSource"
               maxActive="20" maxIdle="5" maxWait="10000"
               username="websupermarketproduct" password="websupermarketproduct" 
               driverClassName="com.mysql.jdbc.Driver"
               url="jdbc:mysql://localhost:3306/websupermarketproduct_tracker?useSSL=false"/>            
</Context>
WEB-INFO/lib/web.xml
<?xml version="1.0" encoding="UTF-8"?>
<web-app xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://xmlns.jcp.org/xml/ns/javaee" xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd" id="WebApp_ID" version="3.1">
  <display-name>websupermarketproduct</display-name>
  <welcome-file-list>
  <welcome-file>JDBCConnectTestServelet</welcome-file>
    <welcome-file>index.html</welcome-file>
    <welcome-file>index.htm</welcome-file>
    <welcome-file>index.jsp</welcome-file>

    
  </welcome-file-list>
</web-app>

servlet init vs constructor
The init() method is typically used to perform servlet initialization--creating or loading objects that are used by the servlet in the handling of its requests. Why not use a constructor instead? Well, in JDK 1.0 (for which servlets were originally written), constructors for dynamically loaded Java classes (such as servlets) couldn't accept arguments. So, in order to provide a new servlet any information about itself and its environment, a server had to call a servlet's init() method and pass along an object that implements the ServletConfig interface. Also, Java doesn't allow interfaces to declare constructors. This means that the javax.servlet.Servlet interface cannot declare a constructor that accepts a ServletConfig parameter. It has to declare another method, like init(). It's still possible, of course, for you to define constructors for your servlets, but in the constructor you don't have access to the ServletConfig object or the ability to throw a ServletException.

The <c:url> tag formats a URL into a string and stores it into a variable. This tag automatically performs URL rewriting when necessary. The var attribute specifies the variable that will contain the formatted URL.

The JSTL url tag is just an alternative method of writing the call to the response.encodeURL() method. The only real advantage the url tag provides is proper URL encoding, including any parameters specified by children param tag.

                     <c:url var="templink" value="StudentControllerServlet">
							<c:param name="command" value="LOAD" />
							<c:param name="student-id" value="${temp.id}" />
						</c:url>
						<c:url var="tempdeletelink" value="StudentControllerServlet">
							<c:param name="command" value="DELETE" />
							<c:param name="student-id" value="${temp.id}" />
						</c:url>
<form action = "PersonServlet" method = "GET">
    <input type= "hidden" name="command" value = "UPDATE"/>
    <input type = "hidden" name="personid"value= "${theCurrentPerson.id}"/>
	<table>
	<a href = "${updateLink}">UPDATE</a> | <a href="${delteLink}">DELETE</a>
//request param spring binding
@RequestMapping("/updateForm")
	public String updateForm(@RequestParam("customerId") int customerid, Model model){

I can only imagine of sending a value from the server to the client which is (unchanged) sent back to maintain a kind of a state.
Precisely. In fact, it's still being used for this purpose today because HTTP as we know it today is still, at least fundamentally, a stateless protocol.

This use case was actually first described in HTML 3.2 (I'm surprised HTML 2.0 didn't include such a description):

type=hidden
These fields should not be rendered and provide a means for servers to store state information with a form. This will be passed back to the server when the form is submitted, using the name/value pair defined by the corresponding attributes. This is a work around for the statelessness of HTTP. Another approach is to use HTTP "Cookies".

<input type=hidden name=customerid value="c2415-345-8563">
While it's worth mentioning that HTML 3.2 became a W3C Recommendation only after JavaScript's initial release, it's safe to assume that hidden fields have pretty much always served the same purpose.

primary kesy: unique row in a table
foreign keys: a column used to pointed to a primary key in another table
cascade: when delete one item, the cascated item in another table will be deleted too

@OneToOne(cascade=CascadeType.ALL) annotation
Entity LifeCycle
New/Transient
Detach
Merge
Persist/managed
Remove
Refresh/sync

rollback 
cascadeType: delete, etc
A database is the main container, it contains the data and log files, and all the schemas within it. You always back up a database, it is a discrete unit on its own. Schemas are like folders within a database, and are mainly used to group logical objects together, which leads to ease of setting permissions by schema.

DROP SCHEMA IF EXISTS `instructor_info`;
CREATE SCHEMA `instructor_info`;
USE `instructor_info`;

SET FOREIGN_KEY_CHECKS = 0;

DROP TABLE IF EXISTS `instructor_detail`;

CREATE TABLE `instructor_detail` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `yutube_channel` varchar(128) DEFAULT NULL,
  `hobby` varchar(45) DEFAULT NULL,
 
  PRIMARY KEY (`id`)
);

DROP TABLE IF EXISTS `instructor`;

CREATE TABLE `instructor` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `first_name` varchar(45) DEFAULT NULL,
  `last_name` varchar(45) DEFAULT NULL,
  `email` varchar(58) DEFAULT NULL,
  `instructor_detail_id` int(11) DEFAULT NULL,
  
  PRIMARY KEY (`id`),
  KEY `FK_DETAIL_idx` (`instructor_detail_id`),
  CONSTRAINT `FK_DETAIL` FOREIGN KEY(`instructor_detail_id`) REFERENCES `instructor_detail` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=latin1;

SET FOREIGN_KEY_CHECKS = 1;

mysql bench->databases->reverse schema

	@OneToOne (cascade = CascadeType.ALL)
	@JoinColumn (name = "instructor_detail_id")
	private InstructorDetail instructorDetail;
The mappedBy attribute is referencing customer while the property is mCustomer, hence the error message. So either change your mapping into:

/** The collection of stores. */
@OneToMany(mappedBy = "mCustomer", cascade = CascadeType.ALL, fetch = FetchType.LAZY)
private Collection<Store> stores;
//need to add both entity class to the session factory config
SessionFactory factory = new Configuration().configure("hibernate.cfg.xml").addAnnotatedClass(Instructor.class).addAnnotatedClass(InstructorDetail.class).buildSessionFactory();
	    Session session = factory.getCurrentSession();
Instructor instructor = new Instructor("Wen","Li","wen@gmail.com");

	    InstructorDetail insDetail = new InstructorDetail("http://youtube.com/xx","jogging");
	    instructor.setInstructorDetail(insDetail);
	    
	    try{
	    	System.out.println(instructor);
	    	System.out.println(insDetail);
	    	System.out.println("begin transaction:");
	    	session.beginTransaction();
		    session.save(instructor);
		    
		    session.getTransaction().commit();

Hibernate cannot simultaneously fetch multiple bags

the problem is that the JPA annotations are parsed not to allow more than 2 eagerly loaded collection. But the hibernate-specific annnotations allow it. 
USE `instructor_info`;
DROP TABLE IF EXISTS `student`;
CREATE TABLE `student` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `first_name` varchar(48) DEFAULT NULL,
  `last_name` varchar(48) DEFAULT NULL,
   
  PRIMARY KEY (`id`)
  
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=latin1;

USE `instructor_info`;
DROP TABLE IF EXISTS `instructor_student`;

CREATE TABLE `instructor_student` (
  `instructor_id` int(11) NOT NULL,  
  `student_id` int(11) NOT NULL,  
  PRIMARY KEY (`instructor_id`,`student_id`),
  CONSTRAINT `FK_INSTRUCTOR_STUDENT` FOREIGN KEY(`instructor_id`) REFERENCES `instructor` (`id`),
  CONSTRAINT `FK_STUDENT_INSTRUCTOR` FOREIGN KEY(`student_id`) REFERENCES `student` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=latin1;

	@ManyToMany(cascade = {CascadeType.DETACH,CascadeType.MERGE,CascadeType.PERSIST,CascadeType.REFRESH})
	@JoinTable( name = "instructor_student",
			joinColumns = @JoinColumn(name = "instructor_id"),
	        inverseJoinColumns = @JoinColumn(name = "student_id")
			)
	private List<Student> students;

	@ManyToMany(cascade = {CascadeType.DETACH,CascadeType.MERGE,CascadeType.PERSIST,CascadeType.REFRESH})
	@JoinTable( name = "instructor_student",
			joinColumns = @JoinColumn(name = "student_id"),
	        inverseJoinColumns = @JoinColumn(name = "instructor_id")
			)
	private List<Instructor> instructors;


@Autowired
@Qualifier("alpha")
VS
@Resource(name="alpha")

@Autowired can be used alone . If it is used alone , it will be wired by type . So problems arises if more than one bean of the same type are declared in the container as @Autowired does not know which beans to use to inject. As a result , use @Qualifier together with @Autowired to clarify which beans to be actually wired by specifying the bean name (wired by name)

@Resource is wired by name too . So if @Autowired is used together with @Qualifier , it is the same as the @Resource.

The difference are that @Autowired and @Qualifier are the spring annotation while @Resource is the standard java annotation (from JSR-250) . Besides , @Resource only supports for fields and setter injection while  @Autowired supports fields , setter ,constructors and multi-argument methods injection.

It is suggested to use @Resource for fields and setter injection. Stick with @Qualifier and @Autowired for constructor or a multi-argument method injection.

Spring @Component, @Repository, @Service and @Controller Annotations
January 23, 2015 by Lokesh Gupta


 
In spring autowiring concepts, we learned about @Autowired annotation that it handles only wiring. You still have to define the beans themselves so the container is aware of them and can inject them for you. But with @Component, @Repository, @Service and @Controller annotations in place and after enabling automatic component scanning, spring will automatically import the beans into the container so you don’t have to define them explicitly with XML. These annotations are called Stereotype annotations as well.

Before jumping to example use of these annotations, let’s learn quick facts about these annotations which will help you in making a better decision about when to use which annotation.

@Component, @Repository, @Service and @Controller annotations

1) The @Component annotation marks a java class as a bean so the component-scanning mechanism of spring can pick it up and pull it into the application context. To use this annotation, apply it over class as below:

@Component
public class EmployeeDAOImpl implements EmployeeDAO {
    ...
}
2) Although above use of @Component is good enough but you can use more suitable annotation that provides additional benefits specifically for DAOs i.e. @Repository annotation. The @Repository annotation is a specialization of the @Component annotation with similar use and functionality. In addition to importing the DAOs into the DI container, it also makes the unchecked exceptions (thrown from DAO methods) eligible for translation into Spring DataAccessException.

3) The @Service annotation is also a specialization of the component annotation. It doesn’t currently provide any additional behavior over the @Component annotation, but it’s a good idea to use @Service over @Component in service-layer classes because it specifies intent better. Additionally, tool support and additional behavior might rely on it in the future.

4) @Controller annotation marks a class as a Spring Web MVC controller. It too is a @Component specialization, so beans marked with it are automatically imported into the DI container. When you add the @Controller annotation to a class, you can use another annotation i.e. @RequestMapping; to map URLs to instance methods of a class.

In real life, you will face very rare situations where you will need to use @Component annotation. Most of the time, you will using @Repository, @Service and @Controller annotations. @Component should be used when your class does not fall into either of three categories i.e. controller, manager and dao.
If you want to define name of the bean with which they will be registered in DI container, you can pass the name in annotation itself e.g. @Service (“employeeManager”).


A JSP is a convenient way to write a servlet that allows you to mix html with scripting elements (although it's recommended to avoid Java code in your jsp in favour of tags and el expressions). Under the covers it will be compiled as a servlet but it avoids you having to use lots of messy print statements.

It's important to have at least a basic understanding of servlets and JSP's. Spring MVC is one of many frameworks built on top of servlets to try make the task of writing a web application a bit easier. Basically all requests are mapped to the DispatcherServlet which acts as a front controller.

The DispatcherServlet will then call the controller whose annotations match the incoming request. This is neater than having to write these mappings yourself in the web.xml (although with servlet 3.0 you can annotate servlets now). But you also get many other benefits that can be used like mapping form fields to an object, validating that object with jsr303 annotations, map inputs and outputs to xml or json etc etc. Plus it's tightly integrated with core spring so you can easily wire in your services for the controller to call.

 The difference between servlets and JSP is that servlets typically embed HTML inside Java code, while JSPs embed Java code in HTML. 
 
 SpringMVCHibernate working together
 WEB-INF/web.xml  and spring-mvc-crud-demo-servlet.xml
 @Repository  specially for DAO
 @Transactional for begin and commit transactions

 Actually c3p0 is a jar file which we uses in hibernate, when we run our hibernate application, we can see in console that there is line "Connection Pool Size 20", that is the number of connection objects available, if we uses only 5 connection then 15 connection objects will be waste, and in industry "Connection Objects" are very costly resources, that's why to define the number of connection objects that may be needed in our application we use c3p0 jar file.

 C3P0 is simply an implementation of the DataSource API, which conceptually sits just above the raw JDBC DriverManager. The main function of a DataSource is acquiring a standard JDBC Connection from it and releasing it in the end.

 session.createQuery("FROM Customer", Customer.class)
 HQL need to From bean name not DB table name, hence, From Customer, not From customer

  @RequestMapping handle all http methods: get and post
  @GetMapping only handle get method equals to (@RequestMapping(path="/processForm", method = RequestMethod.GET))
  @PostMapping short cut for @RequestMapping(path="/processForm", method = RequestMethod.POST)
  GET good for debugging, limit for data length
  POST: no limitation on data length, can also send attachments, for example.
 @Service applied to Service implementations
 Spring will automatically register the Service implements thanks to component-scanning
  service facade design pattern
  Intermediate layer for customer business logic 
  integrate data from multiple source
  Customer service delegate calls to DAO
  service layer and DAO layer

  Service layer: @Service
  DAO layer: @Repository
  move transaction manegement from DAO side to Serivice Side
  
the <form:form> tag plays an important role here; it’s very similar to the regular HTLM <form> tag but the modelAttribute attribute is the key which specifies a name of the model object that backs this form:

For @RequestMapping methods, it has to been string return type.

<form:form action="/customer/saveUpdates" modelAttribute="currentCustomer">
	<form:hidden path = "id"/>

<form:form action="${pageContext.request.contextPath}/account/login" method="post">
confirmation dialog before delete:
Inline event handler
In the most simple way, you can use the confirm() function in an inline onclick handler.
<a href="delete.php?id=22" onclick="return confirm('Are you sure?')">Link</a>
<a href="${deleteLink}" onclick="return confirm('Are you sure you want to Remove?');">Delete</a>

		Session session = sessionFactory.getCurrentSession();
		//session.save(customer);		
		session.saveOrUpdate(customer);
HQL 
Query<Course> query = session.createQuery("select c from Course c where c.instructor.id=:theInstructorId", Course.class);
query.setParameter("theInstructorId", theId);
List<Course> tempCourses = query.getResultList();

The JoinColumn is actually fairly complex and it goes through a number of advanced steps to find the desired column.

This info below is from the documentation

Source: http://docs.oracle.com/javaee/7/api/javax/persistence/JoinColumn.html#name--

---

The table in which it is found depends upon the context.

- If the join is for a OneToOne or ManyToOne mapping using a foreign key mapping strategy, the foreign key column is in the table of the source entity or embeddable.

- If the join is for a unidirectional OneToMany mapping using a foreign key mapping strategy, the foreign key is in the table of the target entity.

- If the join is for a ManyToMany mapping or for a OneToOne or bidirectional ManyToOne/OneToMany mapping using a join table, the foreign key is in a join table.

- If the join is for an element collection, the foreign key is in a collection table.

--

So as you can see, it depends on the context.

In our training video, we are using @OneToMany uni-directional (course has one-to-many reviews).

As a result, the join column / foreign key column is in the target entity. In this case, the target entity is the Review class. So, you will find the join column "course_id" in the "review" table.

AOP proxy: an object created by the AOP framework in order to implement the aspect contracts (advise method executions and so on). In the Spring Framework, an AOP proxy will be a JDK dynamic proxy or a CGLIB proxy. Weaving: linking aspects with other application types or objects to create an advised object.

Best practice for Aspect and Advices
1. keep the code small 
2. keep the code fast
3. Dont perfom any expensive/slow operations
4. Get in and out as quick as possible

AOP advantage:
1. usable modules
2. no more code tangling nor code scattering

AOP disadvantage:
too many aspects will be hard to follow, use AOP with moderation
AspectJ Weaver » 1.8.10
Spring use some of AspectJ annotatioins and classes
development process for AOP
1. create target object: 
2. create spring java config
3. create main app
4. creat an aspect with@befor annotation

	public static void main(String[] args) {
		//read spring config class
		AnnotationConfigApplicationContext context = new AnnotationConfigApplicationContext(DemoConfig.class);
		//get the bean from spring container
		AccountDAO accountDao = context.getBean(AccountDAO.class);
		//call the business method
		accountDao.addAccount();
		//close the context
		context.close();

	}

Aspect pointcut expression language
A predicate expression for where the advice should be applied
Spring AOP use AspectJ's pointcut expression

execution(modifiers-pattern?return-type-pattern declaring-type-pattern?method-name-pattern(param-pattern) throw-pattern?)
pattern with ? is optional
modifiers-pattern: public/private
declaring-type-pattern: class name
modifier and declaring type are optional
before advcice
wildcard: * (match on everything)
@Before("execution(public void com.example.wen.addAccount())")
execution(public void add*())
execution(* processCard*())
@Before("execution(public void com.example.wen.springaop.dao.AccountDAO.addAccount())")

match on parameters
matches a method with no arguments ()
mataches a method with one argument of any type (*)
mataches a method with 0 or more arguments of any type (..)
execution(public void addAccount(com.example.wen.Account)) //parameter match,fully qualified class name is required
exection(* com.example.wen.springaop.*.*(..))//match on methods in a package

@JsonAutoDetect

The Jackson annotation @JsonAutoDetect is used to tell Jackson to include properties which are not public, both when reading and writing objects. Here is an example class showing you how you can use the @JsonAutoDetect annotation:

import com.fasterxml.jackson.annotation.JsonAutoDetect;

@JsonAutoDetect(fieldVisibility = JsonAutoDetect.Visibility.ANY )
public class PersonAutoDetect {

    private long  personId = 123;
    public String name     = null;

}
The JsonAutoDetect.Visibility class contains constants matching the visibility levels in Java, meaning ANY, DEFAULT, NON_PRIVATE, NONE, PROTECTED_AND_PRIVATE and PUBLIC_ONLY.

Jackson Annotations
Some of the more well-known open source Java JSON APIs are:
Jackson
GSON
Boon
JSON.org











